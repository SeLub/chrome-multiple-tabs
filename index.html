<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Update Linkedin profiles in database.</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  </head>

<body>

      <main>
            <div class="container py-4">
              <header class="pb-3 mb-4 border-bottom">
                <a href="/" class="d-flex align-items-center text-dark text-decoration-none">
                  <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-database-fill-add text-success" viewBox="0 0 16 16">
                        <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0ZM8 1c-1.573 0-3.022.289-4.096.777C2.875 2.245 2 2.993 2 4s.875 1.755 1.904 2.223C4.978 6.711 6.427 7 8 7s3.022-.289 4.096-.777C13.125 5.755 14 5.007 14 4s-.875-1.755-1.904-2.223C11.022 1.289 9.573 1 8 1Z"/>
                        <path d="M2 7v-.839c.457.432 1.004.751 1.49.972C4.722 7.693 6.318 8 8 8s3.278-.307 4.51-.867c.486-.22 1.033-.54 1.49-.972V7c0 .424-.155.802-.411 1.133a4.51 4.51 0 0 0-4.815 1.843A12.31 12.31 0 0 1 8 10c-1.573 0-3.022-.289-4.096-.777C2.875 8.755 2 8.007 2 7Zm6.257 3.998L8 11c-1.682 0-3.278-.307-4.51-.867-.486-.22-1.033-.54-1.49-.972V10c0 1.007.875 1.755 1.904 2.223C4.978 12.711 6.427 13 8 13h.027a4.552 4.552 0 0 1 .23-2.002Zm-.002 3L8 14c-1.682 0-3.278-.307-4.51-.867-.486-.22-1.033-.54-1.49-.972V13c0 1.007.875 1.755 1.904 2.223C4.978 15.711 6.427 16 8 16c.536 0 1.058-.034 1.555-.097a4.507 4.507 0 0 1-1.3-1.905Z"/>
                      </svg>
                  <span class="fs-3 text-success px-2">Profiles Updater</span>
                </a>
              </header>
          
              <div class="p-2 mb-4 bg-light rounded-5">
                <div class="container-fluid py-2">
                  <!-- <h1 class="display-5 fw-bold">Custom jumbotron</h1> -->
                  <div class="row mb-2">
                  <div class="col-md-8 fs-4">
                    <div>
                    Add list of urls to form <u>URLs Bank</u> below.<br>
                    </div>
                    <div class="mt-4">
                      <input class="btn btn-success btn-lg" type=button value="Open profiles" id="start" onclick="openProfiles();">
                    </div>
                  </div>

                  <div class="col-md-4 fs-4">
                    This page will help you to update LI profiles in Database.<br> Use only valid <b>https://</b> per line.
                    <!-- <img src="title.png" class="img-thumbnail" alt="Grabli LI profiles"> -->
                  </div>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-10 alert alert-secondary" role="alert" id="message">
                  Hello, I'm ready to work. Insert Link in form below.
                </div>
                <div class="col-md-2">
                  <label for="customRange3" class="form-label">Interval from <span class="badge bg-primary rounded-pill">6</span> to <span class="badge bg-primary rounded-pill" id="interval">10</span></label>
                  
                  <input type="range" class="form-range" min="6" max="20" step="2" id="intervalRange" onchange="setIntervalTo(this.value)">
                </div>
              </div>
              <div class="row align-items-md-stretch">
                  <div class="row g-2">
                        <div class="col-md">
                              <div class="form-floating">
                                    <textarea class="form-control" style="height: 350px; overflow-y: auto;" id="urlBank"></textarea>
                                    <label for="floatingTextarea">URLs Bank</label>
                                  </div>
                        </div>
                        <div class="col-md">
                          <div class="form-floating">
                              <div class="form-floating">
                                    <textarea class="form-control" style="height: 350px; overflow-y: auto;" id="eventLog"></textarea>
                                    <label for="floatingTextarea">Event logger</label>
                                  </div>
                          </div>
                        </div>
                      </div>
              </div>
          
              <footer class="pt-3 mt-4 text-muted border-top">
                © 2023 Grabli
              </footer>
            </div>
          </main>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Video tutorial</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <video controls="controls" width="100%" height="100%" name="Video Tutorial">
          <source src="quick_start.mov">
        </video>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


   <script type="text/javascript"> 
      let linkArray = [];
      let processAvailable = false;
      let intervalTo = 10;

      let logPanel = document.getElementById("eventLog");
      let urlBank = document.getElementById('urlBank');
      urlBank.addEventListener('change', updateUrlBank);
      let message = document.getElementById('message');
      let processButton = document.getElementById('start');
      let intervalMessage = document.getElementById('interval');

      logPanel.innerHTML += 'Interval = ' + intervalTo + "\n";
  
      processButton.disabled = true;

      function setIntervalTo(value) {
        intervalMessage.innerHTML = value;
        intervalTo = value;
        logPanel.innerHTML +='Set Interval to ' + intervalTo + "\n";
      }

      function sendMessage (text, color){
        // color variants: primary, secondary, success, danger, warning, info, light, dark
        message.innerHTML = text;
        message.className = 'col-md-8 alert alert-' + color;
      }
      
      function validateURL(url) {
        if(/^(http(s):\/\/.)[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)$/g.test(url)) {
          return true;
        } else {
          return false;
        }
      }

      function validateTextInput(textInput) {
        linkArray = textInput.trim().split('\n');
        jsonArray = [];
        validatedArray = linkArray.map((url) => validateURL(url));
        console.log(validatedArray);
        if (validatedArray.includes(false)) { return false } else { return true };
      }

      function updateUrlBank(){
        if(urlBank.value !== '') {
          let textInput = urlBank.value;
            if (validateTextInput(textInput)) {
              processButton.disabled = false;
              sendMessage('URLs are valid', 'success'); 
            } else {
              processButton.disabled = true;
              sendMessage('URLs are not valid ', 'danger');
            }
        } else {
          sendMessage('Please, insert URLs below', 'danger');
        }
      }

      function randomInteger(min, max) {
            // случайное число от min до (max+1)
            let rand = Math.floor(Math.random() * (max - min + 1) + min)
            console.log('min ', min, ' max ', max, ' rand ', rand);
            return rand;
      }

      const openUrl = (url, interval) => {
            let link     = document.createElement('a');
            link.href    = url;
            link.target  = '_blank';

            const node = document.createTextNode(url);
            link.appendChild(node);
            link.click();
      }

      function openProfiles() {
          logPanel.innerHTML += '  Process started...\n';
          let interval  = 2;
          linkArray.forEach((url) => {
            interval = interval + randomInteger(6, intervalTo) * 1000;
            console.log('Interval = ', interval);
            logPanel.innerHTML += '    ' + url + '........ ~' + Math.round(interval/1000) +" sec\n";
            setTimeout(() => openUrl(url, interval), interval);
          });
      }

</script>
</body>

</html>